<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#007acc">
    <meta name="description" content="HPL IDE - H Programming Language 集成开发环境，支持 YAML 格式语法的面向对象编程语言">
    <title>HPL IDE - H Programming Language</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚀</text></svg>">

    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js" onerror="handleMonacoLoadError()"></script>
    <script>
        function handleMonacoLoadError() {
            var errorDiv = document.createElement('div');
            errorDiv.id = 'monaco-error-overlay';
            errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1e1e1e; color: #ccc; display: flex; align-items: center; justify-content: center; z-index: 9999; font-family: sans-serif;';
            errorDiv.innerHTML = '<div style="text-align: center; padding: 20px;"><h1 style="color: #f48771;">加载失败</h1><p>无法加载 Monaco Editor。请检查网络连接或刷新页面重试。</p><button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; cursor: pointer; background: #0e639c; color: white; border: none; border-radius: 3px;">刷新页面</button></div>';
            if (document.body) {
                document.body.appendChild(errorDiv);
            } else {
                window.addEventListener('DOMContentLoaded', function() {
                    document.body.appendChild(errorDiv);
                });
            }
        }
    </script>

</head>

<body>
    <noscript>
        <div style="padding: 20px; text-align: center; font-family: sans-serif; background: #1e1e1e; color: #ccc; height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div>
                <h1>需要启用 JavaScript</h1>
                <p>HPL IDE 需要 JavaScript 才能正常运行。请在浏览器设置中启用 JavaScript 后刷新页面。</p>
            </div>
        </div>
    </noscript>
    <div id="app">

        <!-- 工具栏 -->
        <div class="toolbar">
            <div class="toolbar-left">
                <span class="logo">HPL IDE</span>
                <button type="button" id="btn-new" class="toolbar-btn" title="新建文件 (Ctrl+N)" aria-label="新建文件">
                    <span class="icon">📄</span> 新建
                </button>
                <button type="button" id="btn-open" class="toolbar-btn" title="打开文件 (Ctrl+O)" aria-label="打开文件">
                    <span class="icon">📂</span> 打开
                </button>
                <button type="button" id="btn-save" class="toolbar-btn" title="保存文件 (Ctrl+S)" aria-label="保存文件">
                    <span class="icon">💾</span> 保存
                </button>
                <div class="toolbar-separator"></div>
                <button type="button" id="btn-run" class="toolbar-btn run-btn" title="运行 (F5)" aria-label="运行程序">
                    <span class="icon">▶️</span> 运行
                </button>
                <button type="button" id="btn-check" class="toolbar-btn" title="检查语法 (Ctrl+Shift+C)" aria-label="检查语法">
                    <span class="icon">🔍</span> 检查
                </button>
                <div class="toolbar-separator"></div>
                <button type="button" id="btn-config" class="toolbar-btn" title="设置 (Ctrl+,)" aria-label="打开设置">
                    <span class="icon">⚙️</span> 设置
                </button>

            </div>
            <div class="toolbar-right">
                <span id="status-indicator" class="status-ready">就绪</span>
            </div>

        </div>

        <!-- 主内容区 -->
        <div class="main-container">
            <!-- 文件资源管理器 -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <span class="sidebar-title">📁 文件资源管理器</span>
                    <button type="button" id="btn-refresh" class="icon-btn" title="刷新文件列表" aria-label="刷新文件列表">🔄</button>
                </div>
                <!-- 面包屑导航（包含工作区/示例脚本切换） -->
                <div id="breadcrumb-nav" class="breadcrumb-nav">
                    <span class="breadcrumb-workspace-name">💼 工作区</span>
                    <button class="breadcrumb-switch-btn" onclick="HPLFileManager.toggleMode()" title="切换工作区/示例脚本">
                        <span>🔄 切换</span>
                    </button>
                </div>



                <div class="file-tree" id="file-tree">

                    <div class="file-item folder expanded" data-path="examples">
                        <span class="file-icon">📂</span>
                        <span class="file-name">examples</span>
                    </div>
                    <div class="file-item file" data-path="examples/example.hpl" style="padding-left: 20px;">
                        <span class="file-icon">📄</span>
                        <span class="file-name">example.hpl</span>
                    </div>
                    <div class="file-item file" data-path="examples/test_builtin_functions.hpl" style="padding-left: 20px;">
                        <span class="file-icon">📄</span>
                        <span class="file-name">test_builtin_functions.hpl</span>
                    </div>
                </div>
            </div>


            <!-- 编辑器区域 -->
            <div class="editor-container">
                <!-- 标签页 -->
                <div class="tabs-container" id="tabs-container">
                    <div class="tab active" data-file="welcome">
                        <span class="tab-icon">👋</span>
                        <span class="tab-title">欢迎使用</span>
                    </div>
                </div>

                <!-- 编辑器 -->
                <div class="editor-wrapper">
                    <div id="editor"></div>
                    <div id="welcome-page" class="welcome-page">
                        <div class="welcome-content">
                            <h1>🚀 HPL IDE</h1>
                            <p class="subtitle">H Programming Language 集成开发环境</p>
                            
                            <div class="welcome-section">
                                <h3>快速开始</h3>
                                <div class="quick-actions">
                                    <button class="action-btn" id="action-new">
                                        <span class="action-icon">📄</span>
                                        <span>新建文件</span>
                                    </button>
                                    <button class="action-btn" id="action-open">
                                        <span class="action-icon">📂</span>
                                        <span>打开文件</span>
                                    </button>
                                    <button class="action-btn" id="action-example">
                                        <span class="action-icon">📋</span>
                                        <span>打开示例</span>
                                    </button>
                                </div>
                            </div>

                            <div class="welcome-section">
                                <h3>关于 HPL</h3>
                                <p>HPL（H Programming Language）是一种基于 YAML 格式的面向对象编程语言，使用动态类型。</p>
                                <ul class="feature-list">
                                    <li>📝 YAML 格式语法</li>
                                    <li>🏗️ 面向对象（类、继承、对象）</li>
                                    <li>🔄 控制流（if/else、for、while）</li>
                                    <li>📦 标准库模块（math、io、json、os、time）</li>
                                    <li>⚡ 内置函数（echo、len、type 等）</li>
                                    <li>🔍 实时语法检查</li>
                                </ul>
                            </div>

                            <div class="welcome-section">
                                <h3>快捷键</h3>
                                <div class="shortcuts">
                                    <div class="shortcut"><kbd>Ctrl+N</kbd> 新建文件</div>
                                    <div class="shortcut"><kbd>Ctrl+O</kbd> 打开文件</div>
                                    <div class="shortcut"><kbd>Ctrl+S</kbd> 保存文件</div>
                                    <div class="shortcut"><kbd>F5</kbd> 运行程序</div>
                                    <div class="shortcut"><kbd>Ctrl+Shift+C</kbd> 检查语法</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 面板调整手柄 -->
        <div class="panel-resizer" id="panel-resizer" title="拖拽调整高度"></div>
        
        <!-- 底部面板 -->
        <div class="bottom-panel" id="bottom-panel">

            <div class="panel-tabs">
                <div class="panel-tabs-left">
                    <div class="panel-tab active" data-panel="output">📤 输出</div>
                    <div class="panel-tab" data-panel="problems">⚠️ 问题</div>
                </div>
                <div class="panel-controls">
                    <button type="button" class="panel-control-btn" id="btn-panel-minimize" title="最小化面板" aria-label="最小化面板">⬇️</button>
                    <button type="button" class="panel-control-btn" id="btn-panel-maximize" title="最大化面板" aria-label="最大化面板">⬆️</button>
                    <button type="button" class="panel-control-btn" id="btn-panel-close" title="关闭面板" aria-label="关闭面板">✕</button>
                </div>
            </div>

            <div class="panel-content">
                <div id="output-panel" class="output-panel">
                    <div class="output-header">
                        <span>程序输出</span>
                        <button type="button" id="btn-clear-output" class="icon-btn" title="清空输出" aria-label="清空输出">🗑️</button>
                    </div>
                    <pre id="output-content" class="output-content"></pre>

                </div>
                <div id="problems-panel" class="problems-panel hidden">
                    <div class="problems-header">
                        <span>语法问题</span>
                        <button type="button" id="btn-check-syntax" class="icon-btn" title="立即检查语法" aria-label="立即检查语法">🔍 检查</button>
                    </div>
                    <div class="problems-content" id="problems-content">
                        <div class="no-problems">点击"检查"按钮或启用自动检查来验证代码语法</div>
                    </div>
                </div>
            </div>
            
            <!-- 面板折叠状态提示 -->
            <div class="panel-collapsed-indicator hidden" id="panel-collapsed-indicator">
                <button type="button" class="panel-restore-btn" id="btn-panel-restore" title="展开面板" aria-label="展开面板">
                    <span>📤 输出面板已折叠</span>
                    <span>⬆️ 点击展开</span>
                </button>
            </div>
        </div>


        <!-- 状态栏 -->
        <div class="statusbar" id="status-bar">
            <div class="statusbar-left">
                <span id="file-info">未选择文件</span>
                <span class="separator">|</span>
                <span id="cursor-info">行 1, 列 1</span>
            </div>
            <div class="statusbar-right">
                <span id="language-mode">HPL</span>
                <span class="separator">|</span>
                <span id="encoding">UTF-8</span>
                <span class="separator">|</span>
                <span class="syntax-status" id="syntax-status">⏳ 等待检查</span>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="file-input" accept=".hpl,.yaml,.yml" class="visually-hidden" aria-label="选择HPL文件">

    <!-- 保存文件对话框 -->

    <div id="save-dialog" class="dialog hidden" role="dialog" aria-modal="true" aria-labelledby="save-dialog-title">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 id="save-dialog-title">保存文件</h3>
                <button type="button" class="dialog-close" id="btn-save-close" aria-label="关闭对话框">×</button>
            </div>
            <label for="save-filename">文件名：</label>
            <input type="text" id="save-filename" placeholder="输入文件名 (例如: main.hpl)" required>
            <div class="dialog-buttons">
                <button type="button" id="btn-save-confirm" class="btn-primary">保存</button>
                <button type="button" id="btn-save-cancel">取消</button>
            </div>
        </div>
    </div>


    <!-- 配置对话框 -->
    <div id="config-dialog" class="dialog hidden" role="dialog" aria-modal="true" aria-labelledby="config-dialog-title">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 id="config-dialog-title">IDE 设置</h3>
                <button type="button" class="dialog-close" id="btn-config-close" aria-label="关闭对话框">×</button>
            </div>
            <div class="config-form">
                <div class="config-item">
                    <label for="config-api-url">后端服务器地址:</label>
                    <input type="url" id="config-api-url" placeholder="http://localhost:5000" required>
                </div>
                <div class="config-item">
                    <label for="config-timeout">请求超时 (毫秒):</label>
                    <input type="number" id="config-timeout" placeholder="7000" min="5000" max="120000" required>
                </div>
                <div class="config-item">
                    <label for="config-font-size">编辑器字体大小:</label>
                    <input type="number" id="config-font-size" placeholder="14" min="8" max="32" required>
                </div>
                <div class="config-item">
                    <label for="config-theme">编辑器主题:</label>
                    <select id="config-theme">
                        <option value="vs-dark">深色 (vs-dark)</option>
                        <option value="vs">浅色 (vs)</option>
                        <option value="hc-black">高对比度 (hc-black)</option>
                    </select>
                </div>
                <div class="config-item checkbox-item">
                    <label for="config-auto-save" class="checkbox-label">
                        <input type="checkbox" id="config-auto-save">
                        <span>启用自动保存</span>
                    </label>
                </div>
                <div class="config-item checkbox-item">
                    <label for="config-auto-check" class="checkbox-label">
                        <input type="checkbox" id="config-auto-check" checked>
                        <span>启用自动语法检查</span>
                    </label>
                </div>
            </div>
            <div class="dialog-buttons">
                <button type="button" id="btn-test-connection" class="btn-secondary">测试连接</button>
                <button type="button" id="btn-config-reset" class="btn-secondary">重置</button>
                <button type="button" id="btn-config-save" class="btn-primary">保存</button>
                <button type="button" id="btn-config-cancel">取消</button>
            </div>
        </div>
    </div>


    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/diagnostics.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/api.js"></script>
    <script src="js/fileManager.js"></script>
    <script src="js/app.js"></script>


</body>
</html>
